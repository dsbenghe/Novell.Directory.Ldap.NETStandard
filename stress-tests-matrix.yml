jobs:
  - ${{ each image in parameters.image }}:
    - ${{ each concurrency_level in parameters.concurrency_level }}:
      - ${{ each transport_security in parameters.security }}:
        - ${{ each netfx in parameters.netfx }}:
          - job: 
            displayName: ${{ netfx }}_${{ image }}_${{ concurrency_level }}_${{ transport_security }}
            pool:
              vmImage: ${{ image }}
            steps:
              - task: UseDotNet@2
                displayName: 'Install .NET 6'
                inputs:
                  version: 6.0.x
              - task: UseDotNet@2
                displayName: 'Install .NET 8'
                inputs:
                  version: 8.0.x
              - task: UseDotNet@2
                displayName: 'Install .NET 9'
                inputs:
                  version: 9.0.x
              - task: PowerShell@2
                inputs:
                  filePath: 'build.ps1'
                  arguments: 'test-stress -Fx ${{ netfx }} -ConcurrencyLevel ${{ concurrency_level }} -TransportSecurity ${{ transport_security }}'